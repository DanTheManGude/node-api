machine:
  services:
    - docker

test:
  pre:
    - docker run --name redis -d redis
    - docker build -t ritsse/node-api:$CIRCLE_BRANCH .
  override:
    - docker run -it -v testkeys:/app/keys ritsse/node-api:$CIRCLE_BRANCH npm run keygen
    - docker run -it -v testkeys:/app/keys ritsse/node-api:$CIRCLE_BRANCH npm run lint
    - docker run -it -v testkeys:/app/keys --link redis ritsse/node-api:$CIRCLE_BRANCH npm run test 

deployment:
  development:
    branch: ["devlop", "master"]
    commands:
      - docker login -u $DOCKER_USER -p $DOCKER_PASS -e tech@sse.rit.edu
      - docker push ritsse/node-api:$CIRCLE_BRANCH
