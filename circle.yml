machine:
  services:
    - docker
  node:
    version: 0.12.0

dependencies:
  post:
    - npm install sqlite3 #the cached version doesn't work

test:
  pre:
    - npm run keygen
    - npm run lint

deployment:
  development:
    branch: devlop
    commands:
      - docker build -t ritsse/node-api:$CIRCLE_BRANCH .
      - docker login -u $DOCKER_USER -p $DOCKER_PASS -e tech@sse.rit.edu
      - docker push ritsse/node-api:$CIRCLE_BRANCH
  master:
    branch: master
    owner: rit-sse
    commands:
      - ssh deploy@$SSE_HOST 'cd /docker && docker-compose restart api nginx'
